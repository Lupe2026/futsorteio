<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutSorteio Pro</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#2c3e50">

    <style>
        :root { --azul: #3498db; --amarelo: #f1c40f; --dark: #2c3e50; --danger: #e74c3c; --success: #2ecc71; }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; background: #dfe6e9; }
        
        #splash-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--dark); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; transition: 0.8s; }
        #splash-screen img { width: 150px; animation: pulse 2s infinite; }
        .splash-hidden { opacity: 0; visibility: hidden; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }

        .container { padding: 15px; max-width: 600px; margin: auto; }
        .hidden { display: none; }
        
        .zone-title { background: var(--dark); color: white; padding: 10px; border-radius: 8px; margin: 20px 0 10px; text-align: center; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
        .match-pair { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        
        .team-card { background: white; border-radius: 10px; padding: 10px; border-top: 8px solid #ccc; box-shadow: 0 4px 6px rgba(0,0,0,0.1); position: relative; transition: 0.3s; }
        .team-card.selected { border: 3px solid var(--azul); transform: scale(1.02); z-index: 10; }
        
        .team-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; cursor: pointer; border-radius: 5px; padding: 2px; }
        .team-header:active { background: #eee; }
        .team-header h4 { margin: 0; font-size: 13px; }

        .color-picker { display: flex; gap: 8px; margin-bottom: 10px; justify-content: center; }
        .color-btn { width: 22px; height: 22px; border-radius: 50%; border: 1px solid #ddd; cursor: pointer; }
        .color-btn.none { background: #eee; }
        .color-btn.azul { background: var(--azul); }
        .color-btn.amarelo { background: var(--amarelo); }

        .team-card.team-azul { border-top-color: var(--azul); background: #f0f7ff; }
        .team-card.team-amarelo { border-top-color: var(--amarelo); background: #fffdf5; }

        .team-controls { display: flex; gap: 5px; margin-bottom: 10px; }
        .btn-action { background: #eee; border: 1px solid #ddd; padding: 5px; border-radius: 4px; font-size: 12px; flex: 1; cursor: pointer; }

        .slot { display: flex; justify-content: space-between; align-items: center; padding: 8px; background: #f9f9f9; border: 1px solid #eee; margin-bottom: 4px; border-radius: 5px; font-size: 13px; transition: 0.2s; cursor: pointer; }
        .slot.selected-player { background: var(--azul) !important; color: white; transform: translateX(5px); }
        .slot-actions { display: flex; gap: 5px; }
        .slot-actions button { background: none; border: none; padding: 2px 5px; font-size: 14px; cursor: pointer; }

        button { cursor: pointer; font-weight: bold; border-radius: 6px; border: none; }
        .btn-draw { background: var(--dark); color: white; width: 100%; padding: 15px; font-size: 16px; margin-top: 15px; }
        .btn-add { background: var(--success); color: white; width: 100%; padding: 12px; margin: 10px 0; }
        .btn-clear { background: var(--danger); color: white; padding: 8px 12px; font-size: 12px; }
        .btn-back { background: #636e72; color: white; padding: 8px 15px; margin-bottom: 20px; }
        .header-setup { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .player-item { display: flex; align-items: center; background: white; margin-bottom: 8px; padding: 10px; border-radius: 8px; }
        .player-item input { flex-grow: 1; border: 1px solid #ddd; padding: 8px; border-radius: 4px; margin-right: 10px; }
        .player-item.is-seed { border-left: 5px solid var(--amarelo); }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="ic_fmv.png" alt="Logo">
        <h2>SORTEANDO TIMES</h2>
    </div>

    <div id="screen-setup" class="container">
        <div class="header-setup">
            <h2 style="margin:0">‚öΩ Escala√ß√£o</h2>
            <button class="btn-clear" onclick="clearAllPlayers()">LIMPAR TUDO</button>
        </div>

        <div style="background: white; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
            <label>Jogadores por time:</label>
            <select id="players-per-team" style="width: 100%; padding: 10px; font-size: 16px;">
                <option value="4">4 Jogadores</option>
                <option value="5" selected>5 Jogadores</option>
                <option value="6">6 Jogadores</option>
                <option value="7">7 Jogadores</option>
                <option value="10">10 Jogadores</option>
            </select>
        </div>

        <div id="player-list"></div>
        <button class="btn-add" onclick="addPlayerRow()">+ Adicionar Jogador</button>
        <button class="btn-draw" onclick="drawTeams()">GERAR CONFRONTOS</button>
    </div>

    <div id="screen-result" class="container hidden">
        <button class="btn-back" onclick="showScreen('setup')">‚Üê Voltar √† Lista</button>
        <div id="matches-wrapper"></div>
        <button class="btn-add" onclick="addNewPlayerToResult()">+ Adicionar Jogador Extra</button>
    </div>

    <script>
    let globalTeams = [];
    let selectedTeamIndex = null;
    let selectedPlayerInfo = null;

    window.addEventListener('load', () => {
        setTimeout(() => document.getElementById('splash-screen').classList.add('splash-hidden'), 3000);
        loadFromLocal();
    });

    function saveToLocal() {
        const data = Array.from(document.querySelectorAll('.player-item')).map(item => ({
            name: item.querySelector('input').value,
            isSeed: item.querySelector('input[type="checkbox"]').checked
        })).filter(p => p.name.trim());
        localStorage.setItem('futebol_players', JSON.stringify(data));
    }

    function loadFromLocal() {
        const saved = JSON.parse(localStorage.getItem('futebol_players') || '[]');
        const list = document.getElementById('player-list');
        list.innerHTML = '';
        if(saved.length > 0) saved.forEach(p => addPlayerRow(p.name, p.isSeed));
        else for(let i=0; i<10; i++) addPlayerRow();
    }

    function addPlayerRow(name = "", isSeed = false) {
        const div = document.createElement('div');
        div.className = `player-item ${isSeed ? 'is-seed' : ''}`;
        div.innerHTML = `
            <input type="text" placeholder="Nome" value="${name}" oninput="saveToLocal()">
            <label><input type="checkbox" ${isSeed ? 'checked' : ''} onchange="this.closest('.player-item').classList.toggle('is-seed', this.checked); saveToLocal()"> ‚≠ê</label>
            <button onclick="this.parentElement.remove(); saveToLocal()" style="color:red; background:none; margin-left:10px; font-size:18px;">‚úï</button>
        `;
        document.getElementById('player-list').appendChild(div);
    }

    function showScreen(s) {
        document.getElementById('screen-setup').classList.toggle('hidden', s !== 'setup');
        document.getElementById('screen-result').classList.toggle('hidden', s !== 'result');
        window.scrollTo(0,0);
    }

    function shuffle(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    function drawTeams() {
        const players = Array.from(document.querySelectorAll('.player-item'))
            .map(item => ({ 
                name: item.querySelector('input').value, 
                isSeed: item.querySelector('input[type="checkbox"]').checked 
            }))
            .filter(p => p.name.trim());

        if(players.length === 0) return alert("Insira os nomes!");
        
        const size = parseInt(document.getElementById('players-per-team').value);
        const totalTeams = Math.ceil(players.length / size);
        
        globalTeams = Array.from({ length: totalTeams }, () => {
            let arr = []; arr.color = ""; return arr;
        });

        // 1. Separar Estrelas e Comuns mantendo a ordem da lista
        const seeds = players.filter(p => p.isSeed);
        const commons = players.filter(p => !p.isSeed);

        // 2. Distribuir Estrelas (1 por time, come√ßando do Time 1 e 2)
        seeds.forEach((p, i) => {
            if (i < totalTeams) {
                globalTeams[i].push(p.name);
            } else {
                // Se houver mais estrelas que times, distribui circularmente
                globalTeams[i % totalTeams].push(p.name);
            }
        });

        // 3. Preencher Time 1 e Time 2 com os PRIMEIROS da lista de comuns
        // Calculamos quantas vagas faltam no Time 1 e 2
        let spaceT1 = Math.max(0, size - globalTeams[0].length);
        let spaceT2 = (totalTeams > 1) ? Math.max(0, size - globalTeams[1].length) : 0;
        let totalNeeded = spaceT1 + spaceT2;

        // Pegamos os primeiros 'totalNeeded' jogadores da lista de comuns
        let poolForMainMatch = commons.splice(0, totalNeeded);
        
        // Sorteamos apenas esses primeiros jogadores entre o Time 1 e Time 2
        shuffle(poolForMainMatch).forEach(p => {
            if (globalTeams[0].length < size) {
                globalTeams[0].push(p.name);
            } else if (totalTeams > 1 && globalTeams[1].length < size) {
                globalTeams[1].push(p.name);
            }
        });

        // 4. O restante da lista (quem chegou depois) vai para os pr√≥ximos times
        commons.forEach(p => {
            for (let k = 2; k < totalTeams; k++) {
                if (globalTeams[k].length < size) {
                    globalTeams[k].push(p.name);
                    return;
                }
            }
            // Fallback para o √∫ltimo time caso necess√°rio
            if (totalTeams > 2) globalTeams[totalTeams-1].push(p.name);
            else if (globalTeams[1].length < size) globalTeams[1].push(p.name);
        });

        renderMatches();
        showScreen('result');
    }

    function renderMatches() {
        const wrapper = document.getElementById('matches-wrapper');
        wrapper.innerHTML = '';
        
        wrapper.innerHTML += `<div class="zone-title">üèüÔ∏è Partida Atual</div>`;
        const matchDiv = document.createElement('div');
        matchDiv.className = 'match-pair';
        matchDiv.appendChild(createTeamCard(0));
        if (globalTeams[1]) matchDiv.appendChild(createTeamCard(1));
        wrapper.appendChild(matchDiv);

        if (globalTeams.length > 2) {
            wrapper.innerHTML += `<div class="zone-title">‚è≥ Pr√≥ximos da Fila</div>`;
            for (let i = 2; i < globalTeams.length; i++) {
                wrapper.appendChild(createTeamCard(i));
            }
        }
    }

    function createTeamCard(index) {
        const teamColor = globalTeams[index].color || "";
        const card = document.createElement('div');
        card.className = `team-card ${selectedTeamIndex === index ? 'selected' : ''} team-${teamColor}`;
        card.innerHTML = `
            <div class="team-header" onclick="handleTeamClick(${index})">
                <h4>TIME ${index + 1}</h4>
                <span>${selectedTeamIndex === index ? '‚úÖ' : 'üëÜ'}</span>
            </div>
            <div class="color-picker">
                <div class="color-btn none" onclick="setTeamColor(${index}, '')"></div>
                <div class="color-btn azul" onclick="setTeamColor(${index}, 'azul')"></div>
                <div class="color-btn amarelo" onclick="setTeamColor(${index}, 'amarelo')"></div>
            </div>
            <div class="team-controls">
                <button class="btn-action" onclick="moveTeam(${index}, -1)">üîº</button>
                <button class="btn-action" onclick="moveTeam(${index}, 1)">üîΩ</button>
            </div>
            <div class="slots-container">
                ${globalTeams[index].map((p, i) => `
                    <div class="slot ${selectedPlayerInfo && selectedPlayerInfo.tIdx === index && selectedPlayerInfo.pIdx === i ? 'selected-player' : ''}" 
                         onclick="handlePlayerClick(event, ${index}, ${i})">
                        <span style="flex-grow:1">${p}</span>
                        <div class="slot-actions">
                            <button onclick="event.stopPropagation(); editPlayerInTeam(${index}, ${i})">‚úé</button>
                            <button onclick="event.stopPropagation(); removePlayerInTeam(${index}, ${i})" style="color:red">‚úï</button>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
        return card;
    }

    function handlePlayerClick(event, tIdx, pIdx) {
        event.stopPropagation();
        if (selectedPlayerInfo) {
            const fromT = selectedPlayerInfo.tIdx;
            const fromP = selectedPlayerInfo.pIdx;
            if (fromT === tIdx && fromP === pIdx) {
                selectedPlayerInfo = null;
            } else {
                const playerToMove = globalTeams[fromT].splice(fromP, 1)[0];
                globalTeams[tIdx].splice(pIdx, 0, playerToMove);
                selectedPlayerInfo = null;
            }
        } else {
            selectedPlayerInfo = { tIdx, pIdx };
            selectedTeamIndex = null;
        }
        renderMatches();
    }

    function handleTeamClick(index) {
        if (selectedPlayerInfo) {
            const fromT = selectedPlayerInfo.tIdx;
            const fromP = selectedPlayerInfo.pIdx;
            const playerToMove = globalTeams[fromT].splice(fromP, 1)[0];
            globalTeams[index].push(playerToMove);
            selectedPlayerInfo = null;
        } else if (selectedTeamIndex === null) {
            selectedTeamIndex = index;
        } else {
            if (selectedTeamIndex !== index) {
                const temp = globalTeams[selectedTeamIndex];
                globalTeams[selectedTeamIndex] = globalTeams[index];
                globalTeams[index] = temp;
            }
            selectedTeamIndex = null;
        }
        renderMatches();
    }

    function setTeamColor(index, color) {
        globalTeams[index].color = color;
        renderMatches();
    }

    function moveTeam(index, direction) {
        const newIndex = index + direction;
        if (newIndex >= 0 && newIndex < globalTeams.length) {
            const temp = globalTeams[index];
            globalTeams[index] = globalTeams[newIndex];
            globalTeams[newIndex] = temp;
            renderMatches();
        }
    }

    function editPlayerInTeam(tIdx, pIdx) {
        const n = prompt("Nome:", globalTeams[tIdx][pIdx]);
        if(n) { globalTeams[tIdx][pIdx] = n; renderMatches(); }
    }

    function removePlayerInTeam(tIdx, pIdx) {
        globalTeams[tIdx].splice(pIdx, 1);
        if(globalTeams[tIdx].length === 0 && globalTeams.length > 2) globalTeams.splice(tIdx, 1);
        renderMatches();
    }

    function addNewPlayerToResult() {
        const n = prompt("Nome do Jogador Extra:");
        if(!n) return;
        const size = parseInt(document.getElementById('players-per-team').value);
        let added = false;
        for(let i=0; i < globalTeams.length; i++) {
            if(globalTeams[i].length < size) { globalTeams[i].push(n); added = true; break; }
        }
        if(!added) {
            let newTeam = [n]; newTeam.color = ""; globalTeams.push(newTeam);
        }
        renderMatches();
    }

    function clearAllPlayers() {
        if(confirm("Limpar tudo?")) { localStorage.removeItem('futebol_players'); loadFromLocal(); }
    }
    </script>
</body>
</html>




